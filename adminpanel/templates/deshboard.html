<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Management Dashboard - Home</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS for Pharmacy Theme -->
    <style>
        body { background-color: #f8f9fa; font-family: 'Nunito', sans-serif; }
        .sidebar { background-color: #007bff; color: white; min-height: 100vh; width: 250px; position: fixed; left: 0; top: 0; }
        .sidebar a { color: white; text-decoration: none; display: block; padding: 10px 20px; }
        .sidebar a:hover { background-color: #0056b3; }
        .main-content { margin-left: 250px; padding: 20px; }
        .card { border: none; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .border-left-primary { border-left: 4px solid #007bff !important; }
        .border-left-warning { border-left: 4px solid #ffc107 !important; }
        .border-left-danger { border-left: 4px solid #dc3545 !important; }
        .border-left-success { border-left: 4px solid #28a745 !important; }
        .text-primary { color: #007bff !important; }
        .text-warning { color: #ffc107 !important; }
        .text-danger { color: #dc3545 !important; }
        .text-success { color: #28a745 !important; }
        .btn-icon-split { display: inline-flex; align-items: center; }
        .btn-icon-split .icon { padding: 0.375rem 0.75rem; background: rgba(255,255,255,0.2); border-radius: 0.35rem 0 0 0.35rem; }
        .btn-icon-split .text { padding: 0.375rem 0.75rem; }
        @media (max-width: 768px) { .main-content { margin-left: 0; } .sidebar { display: none; } }
        
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h4 class="p-3">Pharmacy Admin</h4>
        <ul class="list-unstyled">
            <li><a href="{% url 'deshboard' %}">Dashboard</a></li>
            <li><a href="{% url 'inventory' %}">Inventory</a></li>
            <li><a href="{% url 'sales' %}">Sales</a></li>
            <li><a href="{% url 'customers' %}">Customers</a></li>
            <li><a href="{% url 'debators' %} ">Debtors</a></li>
            <li><a href="{% url 'lowstock' %}">Alerts</a></li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0 text-gray-800">Pharmacy Management Dashboard</h1>
            <button class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
                <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
            </button>
        </div>

        <!-- Summary Cards Row -->
        <div class="row">
            <!-- Total Drugs Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Total Drugs in Inventory
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-drugs">{{total_drug}}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-pills fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Low Stock Alerts Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    Low Stock Alerts
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="low-stock-count">{{low_stock}}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Expired Drugs Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-danger shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                Expired Drugs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="expired-count">{{expired_count}}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-times fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Sales Card -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    Total Sales (This Month)
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-sales">Rs.{{monthly_sales|floatformat:2}}</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts and Recent Activity Row -->
        <div class="row">
            <!-- Inventory Overview Chart Placeholder -->
            <div class="col-xl-8 col-lg-7">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Inventory Overview</h6>
                        <div class="dropdown">
                            <button class="btn btn-link" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Action</a></li>
                                <li><a class="dropdown-item" href="#">Another action</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-area">
                            <canvas id="inventoryChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Sales/Activity -->
            <div class="col-xl-4 col-lg-5">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Recent Sales</h6>
                    </div>
                    <div class="card-body">
                        <div id="recent-sales">
                            {% if recent_orders %}
                                {% for order in recent_orders %}
                                    <p>
                                        <strong>{{ order.name }}</strong>
                                        placed order of
                                        <strong>Rs.{{ order.total_price }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {{ order.datetime|date:"d M Y, h:i A" }}
                                        </small>
                                    </p>
                                {% endfor %}
                            {% else %}
                                <p>No recent orders</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap">
                            <button class="btn btn-primary btn-icon-split m-1" onclick="alert('Redirect to Add Drug page')">
                                <span class="icon text-white-50"><i class="fas fa-plus"></i></span>
                                <span class="text">Add New Drug</span>
                            </button>
                            <button class="btn btn-success btn-icon-split m-1" onclick="alert('Redirect to Record Sale page')">
                                <span class="icon text-white-50"><i class="fas fa-shopping-cart"></i></span>
                                <span class="text">Record Sale</span>
                            </button>
                            <button class="btn btn-info btn-icon-split m-1" onclick="alert('Redirect to Manage Customers page')">
                                <span class="icon text-white-50"><i class="fas fa-users"></i></span>
                                <span class="text">Manage Customers</span>
                            </button>
                            <button class="btn btn-warning btn-icon-split m-1" onclick="alert('Redirect to View Alerts page')">
                                <span class="icon text-white-50"><i class="fas fa-bell"></i></span>
                                <span class="text">View Alerts</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js for Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom JS for Static Data and Chart -->
    <script>
    const ctx = document.getElementById('inventoryChart').getContext('2d');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ product_names|safe }},
            datasets: [{
                label: 'Quantity in Stock',
                data: {{ product_stock|safe }},
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

</body>
</html>